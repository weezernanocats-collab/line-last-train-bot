#!/usr/bin/env python3
"""
ãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒªãƒ¼ãƒ€ãƒ¼ã‚·ã‚¹ãƒ†ãƒ  ãƒ‡ãƒ¢ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

ä½¿ã„æ–¹:
  1. ç’°å¢ƒå¤‰æ•° ANTHROPIC_API_KEY ã‚’è¨­å®š
  2. python demo_multi_agent.py ã‚’å®Ÿè¡Œ
  3. ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’å…¥åŠ›ï¼ˆã¾ãŸã¯ Enter ã§ã‚µãƒ³ãƒ—ãƒ«ã‚’ä½¿ç”¨ï¼‰
"""

import os
import sys

# ç’°å¢ƒå¤‰æ•°ãƒã‚§ãƒƒã‚¯
if not os.environ.get("ANTHROPIC_API_KEY"):
    print("âš ï¸  ã‚¨ãƒ©ãƒ¼: ANTHROPIC_API_KEY ç’°å¢ƒå¤‰æ•°ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚")
    print("")
    print("ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§è¨­å®šã—ã¦ãã ã•ã„:")
    print("  export ANTHROPIC_API_KEY='your-api-key-here'")
    print("")
    sys.exit(1)

from multi_agent import MultiAgentLeaderSystem


def print_banner():
    """ãƒãƒŠãƒ¼ã‚’è¡¨ç¤º"""
    banner = """
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                   â•‘
â•‘      ğŸ¯  ãƒãƒ«ãƒã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒªãƒ¼ãƒ€ãƒ¼ã‚·ã‚¹ãƒ†ãƒ   ğŸ¯                   â•‘
â•‘                                                                   â•‘
â•‘      å¤§å°†ï¼ˆæ­¦å°†å£èª¿ï¼‰ã¨è¶³è»½2äººï¼ˆãã‚Œãã‚Œç•°ãªã‚‹æ€§æ ¼ï¼‰ã«ã‚ˆã‚‹        â•‘
â•‘      å”èª¿çš„å•é¡Œè§£æ±ºã‚·ã‚¹ãƒ†ãƒ                                        â•‘
â•‘                                                                   â•‘
â•‘      ã€ç™»å ´äººç‰©ã€‘                                                 â•‘
â•‘      ãƒ»ä¿¡ç„ï¼ˆå¤§å°†ï¼‰   - çŸ¥ç•¥ã¨æ­¦å‹‡ã‚’å…¼ã­å‚™ãˆãŸæ­¦å°†               â•‘
â•‘      ãƒ»å¤ªéƒï¼ˆè¶³è»½ï¼‰   - æ…é‡ã§å …å®Ÿãªæ€§æ ¼                         â•‘
â•‘      ãƒ»æ¬¡éƒï¼ˆè¶³è»½ï¼‰   - å¤§èƒ†ã§é©æ–°çš„ãªæ€§æ ¼                       â•‘
â•‘                                                                   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
"""
    print(banner)


def get_sample_problems():
    """ã‚µãƒ³ãƒ—ãƒ«å•é¡Œã®ãƒªã‚¹ãƒˆ"""
    return [
        "æ–°ã—ã„Webã‚µãƒ¼ãƒ“ã‚¹ã‚’ç«‹ã¡ä¸Šã’ãŸã„ãŒã€æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ã®é¸å®šã§è¿·ã£ã¦ã„ã‚‹ã€‚ã‚¹ãƒ”ãƒ¼ãƒ‰é‡è¦–ã‹å“è³ªé‡è¦–ã‹ã€ã©ã¡ã‚‰ã®æ–¹é‡ã§é€²ã‚ã‚‹ã¹ãã‹ã€‚",
        "ãƒãƒ¼ãƒ ã®ç”Ÿç”£æ€§ã‚’ä¸Šã’ãŸã„ãŒã€æ®‹æ¥­ã‚’æ¸›ã‚‰ã—ã¤ã¤æˆæœã‚‚å‡ºã™æ–¹æ³•ã‚’è€ƒãˆã¦ã»ã—ã„ã€‚",
        "æ–°å•†å“ã®ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°æˆ¦ç•¥ã‚’è€ƒãˆã¦ã„ã‚‹ã€‚SNSä¸­å¿ƒã§è¡Œãã‹ã€å¾“æ¥ã®åºƒå‘Šã‚‚ä½µç”¨ã™ã‚‹ã‹æ‚©ã‚“ã§ã„ã‚‹ã€‚",
        "ãƒªãƒ¢ãƒ¼ãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ç¶™ç¶šã™ã‚‹ã‹ã€ã‚ªãƒ•ã‚£ã‚¹å›å¸°ã™ã‚‹ã‹ã€ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ã«ã™ã‚‹ã‹æ±ºã‚ã‹ã­ã¦ã„ã‚‹ã€‚",
        "ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—ã¨ã—ã¦è³‡é‡‘èª¿é”ã™ã‚‹ã‹ã€ãƒ–ãƒ¼ãƒˆã‚¹ãƒˆãƒ©ãƒƒãƒ—ã§æˆé•·ã‚’ç›®æŒ‡ã™ã‹åˆ¤æ–­ã—ãŸã„ã€‚",
    ]


def run_interactive():
    """ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ¢ãƒ¼ãƒ‰ã§å®Ÿè¡Œ"""
    print_banner()

    samples = get_sample_problems()

    print("ã€ã‚µãƒ³ãƒ—ãƒ«å•é¡Œã€‘")
    for i, sample in enumerate(samples, 1):
        print(f"  {i}. {sample[:50]}...")
    print("")

    print("èª²é¡Œã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆEnter ã§ã‚µãƒ³ãƒ—ãƒ«1ã‚’ä½¿ç”¨ã€ç•ªå·ã§ã‚µãƒ³ãƒ—ãƒ«é¸æŠï¼‰:")
    user_input = input("> ").strip()

    # å…¥åŠ›ã®å‡¦ç†
    if not user_input:
        problem = samples[0]
        print(f"\nã‚µãƒ³ãƒ—ãƒ«å•é¡Œã‚’ä½¿ç”¨ã—ã¾ã™: {problem}\n")
    elif user_input.isdigit() and 1 <= int(user_input) <= len(samples):
        problem = samples[int(user_input) - 1]
        print(f"\nã‚µãƒ³ãƒ—ãƒ«å•é¡Œ {user_input} ã‚’ä½¿ç”¨ã—ã¾ã™: {problem}\n")
    else:
        problem = user_input

    print("\n" + "ğŸ°" * 25)
    print("  è»è­°é–‹å§‹ï¼")
    print("ğŸ°" * 25 + "\n")

    # ã‚·ã‚¹ãƒ†ãƒ å®Ÿè¡Œ
    system = MultiAgentLeaderSystem()
    results = system.solve(problem)

    # çµæœè¦ç´„
    print("\n" + "=" * 60)
    print(system.get_summary(results))

    return results


def run_with_problem(problem: str):
    """æŒ‡å®šã•ã‚ŒãŸå•é¡Œã§å®Ÿè¡Œ"""
    print_banner()
    print(f"ã€èª²é¡Œã€‘\n{problem}\n")

    print("\n" + "ğŸ°" * 25)
    print("  è»è­°é–‹å§‹ï¼")
    print("ğŸ°" * 25 + "\n")

    system = MultiAgentLeaderSystem()
    results = system.solve(problem)

    print("\n" + "=" * 60)
    print(system.get_summary(results))

    return results


if __name__ == "__main__":
    if len(sys.argv) > 1:
        # ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å¼•æ•°ãŒã‚ã‚‹å ´åˆã¯ãã‚Œã‚’å•é¡Œã¨ã—ã¦ä½¿ç”¨
        problem = " ".join(sys.argv[1:])
        run_with_problem(problem)
    else:
        # ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ¢ãƒ¼ãƒ‰
        run_interactive()
